(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{1075:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return s(3985)}])},223:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(5893);function r(e){let{className:t="h-12",showFullName:s=!1}=e;return s?(0,a.jsxs)("div",{className:"".concat(t," flex items-center justify-center space-x-3"),children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-secondary)] text-white font-bold text-lg lg:text-xl rounded-lg px-3 py-2",children:"E&B"}),(0,a.jsx)("div",{className:"text-[var(--color-primary)] font-bold text-lg lg:text-2xl",children:"\xc9nergie & Bien-\xeatre™"})]}):(0,a.jsx)("div",{className:"".concat(t," flex items-center justify-center bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-secondary)] text-white font-bold text-xl rounded-lg px-4"),children:"E&B"})}},3985:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var a=s(5893),r=s(7294),l=s(1163),c=s(4715),n=s(1565),o=s(5615),i=s(8793),d=s(4570),x=s(1712),m=s(223),u=s(7066);let h="https://soignant-recharge.preview.emergentagent.com";function g(e){let t=RegExp("[\\?&]"+(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"))+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>=5)return{status:"timeout"};try{let s=localStorage.getItem("token"),a=await u.Z.get("".concat(h,"/api/payments/checkout/status/").concat(e),{headers:{Authorization:"Bearer ".concat(s)}});if("paid"===a.data.payment_status)return{status:"success"};if("expired"===a.data.status)return{status:"expired"};return await new Promise(e=>setTimeout(e,2e3)),await p(e,t+1)}catch(e){return console.error("Error checking payment status:",e),{status:"error"}}}function j(){let[e,t]=(0,r.useState)("Accueil"),[s,j]=(0,r.useState)(null),[f,b]=(0,r.useState)([]),[v,N]=(0,r.useState)(null),[y,w]=(0,r.useState)(!0),[k,_]=(0,r.useState)(!1),[S,B]=(0,r.useState)(null),C=(0,l.useRouter)();(0,r.useEffect)(()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(!e||!t){C.push("/login");return}let s=JSON.parse(t);j(s);let a=g("session_id"),r=g("purchase");a&&"success"===r&&(B("checking"),p(a).then(e=>{if("success"===e.status){B("success");let e={...s,has_paid_access:!0};localStorage.setItem("user",JSON.stringify(e)),j(e),window.history.replaceState({},document.title,"/dashboard")}else B("failed")})),P(e)}},[C]);let P=async e=>{try{let t={Authorization:"Bearer ".concat(e)},s=await u.Z.get("".concat(h,"/api/user-quests/today"),{headers:t});b(s.data);let a=await u.Z.get("".concat(h,"/api/dashboard/stats"),{headers:t});N(a.data)}catch(e){var t,s;console.error("Error fetching data:",e),(null===(t=e.response)||void 0===t?void 0:t.status)===401?(localStorage.removeItem("token"),localStorage.removeItem("user"),C.push("/login")):(null===(s=e.response)||void 0===s?void 0:s.status)===403&&console.log("Paid access required")}finally{w(!1)}},E=async e=>{try{let t=localStorage.getItem("token");await u.Z.post("".concat(h,"/api/user-quests/").concat(e,"/complete"),{},{headers:{Authorization:"Bearer ".concat(t)}}),P(t)}catch(e){console.error("Error completing quest:",e)}},D=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),C.push("/login")},I=e=>{"D\xe9connexion"===e?D():(t(e),_(!1))};return y?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"text-lg",children:"Chargement..."})}):s&&!s.has_paid_access?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[(0,a.jsx)(m.Z,{className:"h-12 mx-auto mb-6"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-[var(--color-primary)] mb-4",children:"Acc\xe8s Premium Requis"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Pour acc\xe9der aux fonctionnalit\xe9s compl\xe8tes d'\xc9nergie & Bien-\xeatre™, un acc\xe8s premium est n\xe9cessaire."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:()=>C.push("/pricing"),className:"btn w-full",children:"D\xe9bloquer l'acc\xe8s - 39€"}),(0,a.jsx)("button",{onClick:D,className:"w-full px-4 py-2 text-gray-600 hover:text-gray-800",children:"Se d\xe9connecter"})]})]})}):(0,a.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,a.jsx)("button",{onClick:()=>_(!k),className:"lg:hidden fixed top-4 left-4 z-50 p-2 bg-[var(--color-primary)] text-white rounded-md",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,a.jsxs)("aside",{className:"".concat(k?"translate-x-0":"-translate-x-full"," lg:translate-x-0 fixed lg:static inset-y-0 left-0 z-40 w-64 bg-[var(--color-primary)] text-white flex flex-col p-6 transition-transform duration-300 ease-in-out"),children:[(0,a.jsx)("button",{onClick:()=>_(!1),className:"lg:hidden absolute top-4 right-4 text-white",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsxs)("div",{className:"flex items-center mb-10 mt-8 lg:mt-0",children:[(0,a.jsx)(m.Z,{className:"h-8 mr-3"}),(0,a.jsx)("span",{className:"font-bold text-lg",children:"\xc9nergie & Bien-\xeatre™"})]}),(0,a.jsx)("nav",{className:"flex flex-col space-y-4",children:["Accueil","Qu\xeates","Profil","D\xe9connexion"].map(t=>(0,a.jsx)("button",{onClick:()=>I(t),className:"text-left px-3 py-2 rounded-md transition ".concat(e===t?"bg-[var(--color-secondary)] text-white font-semibold":"hover:bg-[var(--color-secondary)]/70"),children:t},t))}),(0,a.jsx)("div",{className:"mt-auto text-sm text-gray-300",children:"par Discipline-90 — 2025"})]}),k&&(0,a.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>_(!1)}),(0,a.jsxs)("main",{className:"flex-1 p-4 lg:p-10 pt-16 lg:pt-10",children:[(0,a.jsx)(()=>"checking"===S?(0,a.jsx)("div",{className:"bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 m-4 rounded",children:(0,a.jsx)("p",{className:"font-medium",children:"\uD83D\uDD04 V\xe9rification du paiement en cours..."})}):"success"===S?(0,a.jsxs)("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 m-4 rounded",children:[(0,a.jsx)("p",{className:"font-medium",children:"\uD83C\uDF89 Paiement r\xe9ussi ! Bienvenue dans \xc9nergie & Bien-\xeatre™"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Vous avez maintenant acc\xe8s \xe0 toutes les fonctionnalit\xe9s."})]}):"failed"===S?(0,a.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 m-4 rounded",children:[(0,a.jsx)("p",{className:"font-medium",children:"❌ Probl\xe8me avec le paiement"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Veuillez contacter le support si le probl\xe8me persiste."})]}):null,{}),(0,a.jsx)("h1",{className:"text-2xl lg:text-3xl font-bold text-[var(--color-primary)] mb-6",children:e}),"Accueil"===e&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-700 text-base lg:text-lg mb-6",children:["Bienvenue ",null==s?void 0:s.full_name," — retrouve ton \xe9nergie en un coup d'œil ⚡"]}),v&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 lg:gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white p-4 lg:p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-base lg:text-lg font-semibold text-[var(--color-primary)]",children:"Qu\xeates du jour"}),(0,a.jsxs)("p",{className:"text-2xl lg:text-3xl font-bold text-[var(--color-secondary)]",children:[v.today_stats.quests_completed,"/",v.today_stats.total_quests]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 lg:p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-base lg:text-lg font-semibold text-[var(--color-primary)]",children:"Points gagn\xe9s"}),(0,a.jsx)("p",{className:"text-2xl lg:text-3xl font-bold text-[var(--color-secondary)]",children:v.today_stats.total_points})]}),(0,a.jsxs)("div",{className:"bg-white p-4 lg:p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-base lg:text-lg font-semibold text-[var(--color-primary)]",children:"Progression"}),(0,a.jsxs)("p",{className:"text-2xl lg:text-3xl font-bold text-[var(--color-secondary)]",children:[v.today_stats.completion_percentage,"%"]})]})]})]}),"Qu\xeates"===e&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-lg lg:text-xl font-semibold text-[var(--color-secondary)]",children:"Tes qu\xeates du jour"}),(0,a.jsx)("div",{className:"grid gap-4",children:f.map(e=>(0,a.jsxs)("div",{className:"bg-white p-4 lg:p-6 rounded-lg shadow flex flex-col lg:flex-row justify-between lg:items-center",children:[(0,a.jsxs)("div",{className:"mb-4 lg:mb-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-[var(--color-primary)]",children:e.title}),(0,a.jsx)("p",{className:"text-gray-600 text-sm lg:text-base",children:e.description}),(0,a.jsxs)("p",{className:"text-sm text-[var(--color-secondary)]",children:[e.points_reward," points"]})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:"done"===e.status?(0,a.jsx)("span",{className:"px-4 py-2 bg-green-100 text-green-800 rounded-lg font-medium text-sm",children:"✅ Termin\xe9e"}):(0,a.jsx)("button",{onClick:()=>E(e.id),className:"w-full lg:w-auto px-4 py-2 bg-[var(--color-secondary)] text-white rounded-lg hover:opacity-90",children:"Terminer"})})]},e.id))}),v&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 lg:p-6 mt-8",children:[(0,a.jsx)("h3",{className:"text-base lg:text-lg font-bold text-[var(--color-primary)] mb-4",children:"Progression hebdomadaire"}),(0,a.jsx)("div",{className:"h-64 lg:h-80",children:(0,a.jsx)(c.h,{width:"100%",height:"100%",children:(0,a.jsxs)(n.w,{data:v.weekly_data,children:[(0,a.jsx)(o.K,{dataKey:"day",className:"text-xs lg:text-sm"}),(0,a.jsx)(i.B,{className:"text-xs lg:text-sm"}),(0,a.jsx)(d.u,{}),(0,a.jsx)(x.x,{type:"monotone",dataKey:"valeur",stroke:"#3FB28C",strokeWidth:2})]})})})]})]}),"Profil"===e&&s&&(0,a.jsx)("div",{className:"bg-white p-4 lg:p-6 rounded-lg shadow",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-[var(--color-primary)]",children:"Nom :"}),(0,a.jsx)("p",{className:"text-gray-700",children:s.full_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-[var(--color-primary)]",children:"Email :"}),(0,a.jsx)("p",{className:"text-gray-700 break-words",children:s.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-[var(--color-primary)]",children:"M\xe9tier :"}),(0,a.jsx)("p",{className:"text-gray-700 capitalize",children:s.profession})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-[var(--color-primary)]",children:"Statut :"}),(0,a.jsx)("p",{className:"text-gray-700",children:s.has_paid_access?(0,a.jsx)("span",{className:"text-green-600 font-medium",children:"✅ Acc\xe8s Premium"}):(0,a.jsx)("span",{className:"text-orange-600 font-medium",children:"⏳ Acc\xe8s Limit\xe9"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold text-[var(--color-primary)]",children:"Membre depuis :"}),(0,a.jsx)("p",{className:"text-gray-700",children:new Date(s.created_at).toLocaleDateString("fr-FR")})]})]})})]})]})}}},function(e){e.O(0,[143,591,888,774,179],function(){return e(e.s=1075)}),_N_E=e.O()}]);